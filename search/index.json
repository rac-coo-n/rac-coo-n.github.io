[{"content":"生存分析报告 第一步：数据导入与清洗 分析目的 本步骤的目标是将外部电信客户数据集导入分析环境，并进行初步清洗，为后续建模提供结构规范、字段明确、无缺失值的数据源。\n主要步骤与结果 数据来源：IBM 提供的 \u0026ldquo;Telco 客户流失数据集\u0026rdquo;，每条记录代表一位客户，包含其人口特征、服务使用信息、账单信息及是否流失等字段。 数据加载结果： 成功导入原始 CSV 数据； 包括 tenure（服务时间）与 churnString（是否流失）两个关键字段。 数据清洗内容： 去除 totalCharges 缺失记录； 将 churnString 字段转为数值型 churn 字段（1 表示已流失，0 表示未流失）； 删除原始 churnString 字段； 形成清洗后的 Silver 层数据表，共保留约 7032 条记录。 输出结果：结构规范、字段清晰的建模数据表 silver_monthly_customers，作为后续分析基础。 第二步：Kaplan-Meier 生存曲线分析 分析目的 通过 Kaplan-Meier 方法构建客户生存曲线，观察总体及分组客户的留存概率随时间的变化趋势，并用 Log-Rank 检验判断分组之间差异的统计显著性。\n主要分析步骤与结果 Kaplan-Meier 生存函数的估计值定义为：\n$\\hat{S}(t) = \\prod_{t_i \\le t} \\left( 1 - \\frac{d_i}{n_i} \\right)$\n其中：\n$t_i$：发生事件的时间点（按时间顺序排列）； $d_i$：在时间 t_i 发生事件的个数； $n_i$：在时间 t_i 之前仍处于风险中的个体数（即还没失踪，也没发生事件的人）； $\\hat{S}(t)$：在时间 t 仍“存活”（事件未发生）的概率。 横轴（x-axis）：表示时间（即客户与公司的关系持续了多久，单位：月）； 纵轴（y-axis）：表示“还没流失的概率”，也就是 生存概率S(t)。 “协变量层级的 Kaplan-Meier 曲线”指的是分组后的生存曲线，例如按性别、付款方式、是否使用 Online Security 这种特征划分。\n如果两组生存曲线差异大 → 说明这个变量对生存概率有影响； 差异小（曲线几乎重合） → 说明这个变量的预测能力弱。 当肉眼看到曲线差不多时，还要通过统计检验来确认 → 就用 log-rank test（对数秩检验）。\n原假设 H₀：两个组生存曲线无显著差异； 如果 p-value \u0026gt; 0.05 → 保留原假设 → 差异不显著； 如果 p-value \u0026lt; 0.05 → 拒绝原假设 → 差异显著。 性别对客户流失的影响 性别组别 对比组别 检验统计量 (test_statistic) p 值 (p) -log2(p) Female Male 1.61011 0.204476 2.289995 结论：p 值 \u0026gt; 0.05，说明性别对客户流失没有统计显著性差异。\n性别不是客户流失的重要影响因素。\n是否启用在线安全服务对客户流失的影响 是否启用在线安全服务 对比组别 检验统计量 (test_statistic) p 值 (p) -log2(p) No Yes 75.800079 3.138886e-18 58.144453 结论：p 值 \u0026lt; 0.05，说明是否启用在线安全服务对客户流失具有统计显著性差异。\n启用在线安全服务显著降低了客户流失风险。\nonlineSecurity 很可能是显著的影响因素。\n除了 phoneService 和 gender，其余协变量在 Log-rank 检验中均表现出显著的生存曲线差异（p \u0026lt; 0.05） ，即它们对客户流失具有统计意义上的影响。\n协变量（变量名） 含义简述 显著性 gender 性别 ❌ 否 phoneService 是否有电话服务 ❌ 否 internetService 上网服务类型（DSL/Fiber等） ✔️ 是 paymentMethod 付款方式 ✔️ 是 techSupport 是否启用技术支持 ✔️ 是 onlineSecurity 是否启用在线安全服务 ✔️ 是 onlineBackup 是否启用在线备份 ✔️ 是 deviceProtection 是否启用设备保护 ✔️ 是 partner 是否有配偶 ✔️ 是 dependents 是否有家属 ✔️ 是 seniorCitizen 是否为老年人 ✔️ 是 paperlessBilling 是否使用电子账单 ✔️ 是 multipleLines 是否开通多线路 ✔️ 是 streamingTV 是否使用 TV 串流服务 ✔️ 是 streamingMovies 是否看电影串流服务 ✔️ 是 1 pd.DataFrame(sp_internet_dsl.survival_function_at_times(range(0,10))) 输出如下：\n时间（月） 生存概率（DSL） 0 1.000000 1 0.902698 2 0.864380 3 0.834702 4 0.810522 5 0.794352 6 0.783900 7 0.776362 8 0.768486 9 0.750833 生存函数表示：在第 t 月仍“存活”（即未流失）的客户比例；\n对 DSL 用户来说，流失率在前几个月下降较快，说明早期是关键时段； 到第 9 个月，约有75% 的 DSL 用户仍然在网 。 第三步：Cox 比例风险模型分析 分析目的 利用 Cox 模型识别影响客户流失风险的重要因素，量化其对风险的影响方向和强度，建立对客户流失风险进行定量评估的基础模型。\n$\\text{Hazard Ratio } h(t) = h_0(t) \\cdot e^{\\beta_1 x_1 + \\beta_2 x_2 + \\cdots + \\beta_p x_p}$\n项 含义 $h(t)$ 某人在 t 时间点的风险率 $h_0(t)$ 基准风险（baseline hazard）——当所有变量为 baseline 值时的风险 $\\beta_i$ 第 i 个变量对应的系数（由模型训练得到） $x_i$ 第 i 个变量的数值（是否是 baseline） 这代表模型在计算其他组的风险时，都是以这些值为参考组（HR = 1.0）进行比较的。\nCox 比例风险模型的核心假设是：协变量对风险的影响在时间上保持恒定，即“比例风险假设”。这意味着不同组之间的风险比（Hazard Ratio）不会随着时间推移而改变，而是维持一个固定倍数。风险函数可分解为：一个随时间变化的基准风险（baseline hazard） × 一个随协变量变化、但与时间无关的部分风险（partial hazard）。\n主要分析步骤与结果 数据准备：基于第二步构建的清洗后客户数据表（silver_monthly_customers），选取 tenure（服务时间）作为生存时间变量，churn（流失标记）作为事件变量。 变量筛选与编码： 纳入多个分类变量（如 contract, paymentMethod, internetService, paperlessBilling 等）； 使用 One-Hot 编码处理分类变量，确保变量可用于模型计算。Cox 模型只接受数值型变量，因此在使用 lifelines.CoxPHFitter 拟合模型前， 必须将类别型变量转化为哑变量（dummy variables） 。 拟合 Cox 比例风险模型：\n使用 Lifelines 库中的 CoxPHFitter 进行模型拟合； 输出每个协变量的 coef（回归系数）、exp(coef)（风险比）及 P 值。 使用 Cox 比例风险模型对客户流失进行了建模，所有变量的 p 值均小于 0.005，具备统计显著性。系数估计的置信区间未跨越 1，说明模型稳定性良好。以 internetService_DSL 为例，风险比为 0.80，表明使用 DSL 的客户流失风险较基准组低 20%。模型评估指标如 C-index 和对数似然比也支持模型拟合效果良好。\n模型诊断：检验比例风险假设成立性、模型拟合优度以及变量显著性。\n在使用 cph.check_assumptions() 对 Cox 模型进行比例风险假设检验后发现，dependents_Yes 满足假设，而 internetService_DSL、onlineBackup_Yes 和 techSupport_Yes 的 p 值均小于 0.005，显著违反比例风险假设。Lifelines 建议对这些变量使用 strata 参数进行分层建模，以消除变量对风险比随时间变化的影响，增强模型的稳健性。\n特征选择：包括合同类型、支付方式、互联网服务、电子账单等。\n使用 Schoenfeld 残差图对 Cox 模型中变量的比例风险假设进行了可视化验证。结果显示：internetService_DSL, onlineBackup_Yes, 和 techSupport_Yes 这三个变量在残差图中呈现明显随时间变化的趋势，违反比例风险假设。而 dependents_Yes 线条较为平稳，符合假设。为此，建议在重新拟合 Cox 模型时将上述三个变量加入 strata 参数进行分层建模，以增强模型稳健性并控制风险比随时间变化带来的偏差。\n通过 log-log 转换后的 Kaplan-Meier 生存曲线进一步验证比例风险假设。分析发现，除了 internetService 变量外，其余变量的 log-log 曲线大多呈平行趋势，表明它们较好地符合假设。而 internetService 在 log(time) \u0026lt; 1 或 \u0026gt; 3 的区间内存在明显的曲线偏离，再次证实了其不满足比例风险假设，应在建模中使用 strata 处理。\n第四步：加速失效时间模型（AFT）分析 分析目的 AFT 模型的基本思想是：不同组别的生存函数之间存在一个时间加速因子（Acceleration Factor, λ）****，而不是像 Cox 模型那样假设风险比恒定。\n$S_A(t) = S_B(\\lambda t)$\n$S_A(t)$：组 A 的生存函数； $S_B(t)$：组 B 的生存函数； $\\lambda$：加速因子（λ \u0026lt; 1 表示 A 组比 B 更快“失效”，λ \u0026gt; 1 表示更慢）。 分析步骤 数据准备：使用 silver_monthly_customers 数据表，选取 tenure 作为留存时间变量，churn 作为事件变量；\n变量编码：对 contract, internetService, paperlessBilling 等分类变量进行 One-Hot 编码处理；\n模型拟合：使用 Lifelines 库中的 AFTFitter 进行加速失效时间模型训练，选用 log-normal 分布假设；\n模型采用对数时间下的生存函数建模结构，在对数转换回实际时间后，得出中位生存时间为 135.51\n结果输出：提取模型中每个变量的系数、P 值及其方向，用于解释变量对生存时间的加速或延缓作用。\n本次 Log-Logistic AFT 模型结果表明，所有变量均具有统计显著性，且对客户流失时间有显著的延缓作用。其中，onlineSecurity_Yes（加速因子约 10.7）、partner_Yes（2.09）和 onlineBackup_Yes（2.25）是影响最大的因素，显著延长了客户的在网时间。模型的 Concordance 指数为 0.73，优于 Cox 模型的 0.64，说明其在预测客户生命周期方面具有更高的判别能力，是在违反比例风险假设情况下的有效替代模型。\n模型结果检验：在对 Log-Logistic AFT 模型进行假设检验时，通过 log-log 生存曲线图观察发现，大多数变量的曲线在图中较为平行，整体呈线性趋势，说明该模型在大体上满足 比例优势假设（Proportional Odds Assumption），且 Log-Logistic 分布作为指定分布是合理的选择。虽然部分变量在某些时间段存在轻微偏离，但整体线性关系良好，支持我们继续采用 AFT 模型进行解释与预测。\n第五步：生存概率驱动的客户价值评估 分析目的 使用 Cox 比例风险模型（Cox Proportional Hazards Model）对 IBM Telco 客户流失数据进行建模，进一步估算客户生命周期价值（Customer Lifetime Value）。\n分析步骤与方法 1. 编码与数据准备（Data Preparation）\n使用 pd.get_dummies() 对分类变量进行 One-Hot 编码；\n明确指定模型需要使用的变量，如 tenure, churn, internetService_DSL, onlineBackup_Yes 等；\n构建 survival_pd 数据集，用于后续生存分析建模。\n2. 拟合 Cox 比例风险模型（Fit Cox Proportional Hazards Model）\n使用 lifelines.CoxPHFitter() 进行建模；\n指定 tenure 为时间变量，churn 为事件变量；\n模型成功拟合后，可用于预测客户留存概率。\n3. 创建交互组件（Widgets for Dashboard）\n利用 dbutils.widgets 构建交互式下拉框（如是否有 TechSupport、OnlineBackup 等）； 用户可动态选择变量组合，进行客户细分分析； 所选值传入生存函数，用于预测分组客户的未来表现。 4. 构建仪表盘表格（Create Table for Dashboard）\n核心是 get_payback_df() 函数，输出用户每月的财务价值评估；\n包含以下重要财务列：\nSurvival Probability （生存概率） Monthly Profit for Selected Plan （假设利润，例：$30） Avg Expected Monthly Profit （期望月利润 = 生存概率 × 利润） NPV（净现值，考虑 10% 折现率） Cumulative NPV（累计净现值，反映累计获利能力） 5. 可视化结果NPV和生存概率曲线\n","date":"2025-04-14T00:00:00Z","image":"https://example.com/p/%E5%9F%BA%E4%BA%8E%E7%94%B5%E4%BF%A1%E5%AE%A2%E6%88%B7%E6%95%B0%E6%8D%AE%E7%9A%84%E7%94%9F%E5%AD%98%E5%88%86%E6%9E%90%E4%BB%8E%E5%BB%BA%E6%A8%A1%E5%88%B0%E5%AE%A2%E6%88%B7%E4%BB%B7%E5%80%BC%E8%AF%84%E4%BC%B0/image_hu_fa159729a7675793.png","permalink":"https://example.com/p/%E5%9F%BA%E4%BA%8E%E7%94%B5%E4%BF%A1%E5%AE%A2%E6%88%B7%E6%95%B0%E6%8D%AE%E7%9A%84%E7%94%9F%E5%AD%98%E5%88%86%E6%9E%90%E4%BB%8E%E5%BB%BA%E6%A8%A1%E5%88%B0%E5%AE%A2%E6%88%B7%E4%BB%B7%E5%80%BC%E8%AF%84%E4%BC%B0/","title":"基于电信客户数据的生存分析：从建模到客户价值评估"},{"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;—\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\n— Rob Pike1\nTables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Inline Markdown within tables Italics Bold Code italics bold code A B C D E F Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ultricies, sapien non euismod aliquam, dui ligula tincidunt odio, at accumsan nulla sapien eget ex. Proin eleifend dictum ipsum, non euismod ipsum pulvinar et. Vivamus sollicitudin, quam in pulvinar aliquam, metus elit pretium purus Proin sit amet velit nec enim imperdiet vehicula. Ut bibendum vestibulum quam, eu egestas turpis gravida nec Sed scelerisque nec turpis vel viverra. Vivamus vitae pretium sapien Code Blocks Code block with backticks 1 2 3 4 5 6 7 8 9 10 \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block with Hugo\u0026rsquo;s internal highlight shortcode 1 2 3 4 5 6 7 8 9 10 \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Diff code block 1 2 3 4 5 [dependencies.bevy] git = \u0026#34;https://github.com/bevyengine/bevy\u0026#34; rev = \u0026#34;11f52b8c72fc3a568e8bb4a4cd1f3eb025ac2e13\u0026#34; - features = [\u0026#34;dynamic\u0026#34;] + features = [\u0026#34;jpeg\u0026#34;, \u0026#34;dynamic\u0026#34;] List Types Ordered List First item Second item Third item Unordered List List item Another item And another item Nested list Fruit Apple Orange Banana Dairy Milk Cheese Other Elements — abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL + ALT + Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nHyperlinked image The above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2019-03-11T00:00:00Z","image":"https://example.com/p/markdown-syntax-guide/pawel-czerwinski-8uZPynIu-rQ-unsplash_hu_e95a4276bf860a84.jpg","permalink":"https://example.com/p/markdown-syntax-guide/","title":"Markdown Syntax Guide"},{"content":"Lorem est tota propiore conpellat pectoribus de pectora summo.\nRedit teque digerit hominumque toris verebor lumina non cervice subde tollit usus habet Arctonque, furores quas nec ferunt. Quoque montibus nunc caluere tempus inhospita parcite confusaque translucet patri vestro qui optatis lumine cognoscere flos nubis! Fronde ipsamque patulos Dryopen deorum.\nExierant elisi ambit vivere dedere Duce pollice Eris modo Spargitque ferrea quos palude Rursus nulli murmur; hastile inridet ut ab gravi sententia! Nomine potitus silentia flumen, sustinet placuit petis in dilapsa erat sunt. Atria tractus malis.\nComas hunc haec pietate fetum procerum dixit Post torum vates letum Tiresia Flumen querellas Arcanaque montibus omnes Quidem et Vagus elidunt The Van de Graaf Canon\nMane refeci capiebant unda mulcebat Victa caducifer, malo vulnere contra dicere aurato, ludit regale, voca! Retorsit colit est profanae esse virescere furit nec; iaculi matertera et visa est, viribus. Divesque creatis, tecta novat collumque vulnus est, parvas. Faces illo pepulere tempus adest. Tendit flamma, ab opes virum sustinet, sidus sequendo urbis.\nIubar proles corpore raptos vero auctor imperium; sed et huic: manus caeli Lelegas tu lux. Verbis obstitit intus oblectamina fixis linguisque ausus sperare Echionides cornuaque tenent clausit possit. Omnia putatur. Praeteritae refert ausus; ferebant e primus lora nutat, vici quae mea ipse. Et iter nil spectatae vulnus haerentia iuste et exercebat, sui et.\nEurytus Hector, materna ipsumque ut Politen, nec, nate, ignari, vernum cohaesit sequitur. Vel mitis temploque vocatus, inque alis, oculos nomen non silvis corpore coniunx ne displicet illa. Crescunt non unus, vidit visa quantum inmiti flumina mortis facto sic: undique a alios vincula sunt iactata abdita! Suspenderat ego fuit tendit: luna, ante urbem Propoetides parte.\n","date":"2019-03-09T00:00:00Z","image":"https://example.com/p/placeholder-text/matt-le-SJSpo9hQf7s-unsplash_hu_c1ca39d792aee4ab.jpg","permalink":"https://example.com/p/placeholder-text/","title":"Placeholder Text"},{"content":"Mathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.\nIn this example we will be using KaTeX\nCreate a partial under /layouts/partials/math.html Within this partial reference the Auto-render Extension or host these scripts locally. Include the partial in your templates like so: 1 2 3 {{ if or .Params.math .Site.Params.math }} {{ partial \u0026#34;math.html\u0026#34; . }} {{ end }} To enable KaTeX globally set the parameter math to true in a project\u0026rsquo;s configuration To enable KaTeX on a per page basis include the parameter math: true in content files Note: Use the online reference of Supported TeX Functions\nExamples Inline math: $\\varphi = \\dfrac{1+\\sqrt5}{2}= 1.6180339887…$\nBlock math: $$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$","date":"2019-03-08T00:00:00Z","permalink":"https://example.com/p/math-typesetting/","title":"Math Typesetting"},{"content":"Emoji can be enabled in a Hugo project in a number of ways.\nThe emojify function can be called directly in templates or Inline Shortcodes.\nTo enable emoji globally, set enableEmoji to true in your site\u0026rsquo;s configuration and then you can type emoji shorthand codes directly in content files; e.g.\n🙈 :see_no_evil: 🙉 :hear_no_evil: 🙊 :speak_no_evil:\nThe Emoji cheat sheet is a useful reference for emoji shorthand codes.\nN.B. The above steps enable Unicode Standard emoji characters and sequences in Hugo, however the rendering of these glyphs depends on the browser and the platform. To style the emoji you can either use a third party emoji font or a font stack; e.g.\n1 2 3 .emoji { font-family: Apple Color Emoji, Segoe UI Emoji, NotoColorEmoji, Segoe UI Symbol, Android Emoji, EmojiSymbols; } ","date":"2019-03-05T00:00:00Z","image":"https://example.com/p/emoji-support/the-creative-exchange-d2zvqp3fpro-unsplash_hu_27b8954607cdb515.jpg","permalink":"https://example.com/p/emoji-support/","title":"Emoji Support"}]